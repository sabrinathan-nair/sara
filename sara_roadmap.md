# Sara Roadmap: Enhancing Type Safety and Usability

This roadmap outlines a phased approach to address the shortcomings of the Sara DataFrame library identified in the `sara_vs_frames.md` comparison, with a focus on improving type safety, performance, API ergonomics, and ecosystem integration.

## Phase 1: Enhance Type Safety and Eliminate Runtime Fallbacks (Completed)

**Goal:** Refactor functions that currently rely on runtime `DFValue` operations to leverage type-level schema information, similar to `selectColumns` and `dropColumns`. This will maximize compile-time guarantees and prevent runtime errors.

**Achievement:** This phase has been successfully completed, with all core DataFrame operations now offering 100% compile-time guarantees, eliminating runtime fallbacks for schema and type correctness.



## Phase 2: Optimize Data Representation

**Goal:** Investigate and implement more efficient internal data representations to reduce boxing/unboxing overhead associated with `DFValue` and improve overall performance, especially for numerical operations.

**Steps:**

1.  **Benchmark Current Performance:** Establish baseline performance metrics for common operations (e.g., numerical computations, filtering) using the current `DFValue` representation.

2.  **Explore Alternatives to `DFValue`:** Research and evaluate alternative internal representations for DataFrame columns that minimize or eliminate the need for `DFValue` for common, known types (e.g., `Int`, `Double`, `Text`).
    *   *Considerations:* Type-indexed vectors, heterogeneous lists (e.g., `HList`), or other techniques that allow direct storage of Haskell primitive types while maintaining type-level schema information.

3.  **Implement Optimized Representation:** Gradually refactor the `DataFrame`'s internal structure and associated functions to use the chosen optimized representation.

4.  **Re-benchmark and Validate:** Re-benchmark performance after implementing changes to quantify improvements. Ensure that the new representation maintains type safety and correctness.

## Phase 3: Improve API Ergonomics

**Goal:** Make Sara's API more idiomatic, concise, and user-friendly, reducing verbosity and the need for explicit `Proxy` arguments.

**Steps:**

1.  **Consistent Use of Overloaded Labels/Type Applications:** Leverage GHC extensions like `OverloadedLabels` and `TypeApplications` more consistently across the API to simplify column access and type inference, reducing the need for explicit `Proxy` arguments.

2.  **Develop Convenient Combinators:** Design and implement higher-level combinators for common data manipulation patterns (e.g., chained transformations, conditional operations) to make data pipelines more concise and readable.

3.  **Refine Type Signatures:** Ensure that user-facing function type signatures are as clear and concise as possible, highlighting the essential type-level information without unnecessary clutter.

4.  **Enhance Haddock Documentation:** Provide extensive Haddock documentation for all API functions, including clear descriptions, type signatures, and practical usage examples that demonstrate the improved ergonomics.

## Phase 4: Expand Ecosystem Integration

**Goal:** Improve Sara's interoperability with other established Haskell data science and numerical computing libraries.

**Steps:**

1.  **Identify Key Integration Targets:** Determine which external Haskell libraries (e.g., for plotting, advanced statistics, machine learning, database connectivity) are most crucial for a comprehensive data science workflow.

2.  **Develop Conversion Utilities:** Implement conversion functions or type class instances to facilitate seamless data exchange between Sara's `DataFrame` and the data structures used by target libraries.
    *   *Example:* Functions to convert a `DataFrame` to/from `Vector`s of records, or to/from data structures used by plotting libraries.

3.  **Explore FFI for Performance-Critical Operations:** For highly performance-critical operations, investigate the potential for using the Foreign Function Interface (FFI) to integrate with optimized C/C++ libraries (e.g., for linear algebra, numerical analysis).

## Phase 5: Enhance Error Handling and User Experience

**Goal:** Provide more informative and actionable error messages, particularly for compile-time type errors, to improve the developer experience.

**Steps:**

1.  **Review and Refine `TypeError` Messages:** Systematically review all custom `TypeError` messages generated by Sara's type-level machinery. Ensure they are precise, clearly explain the violation, and suggest how to resolve it.

2.  **Implement Custom Error Messages for Common Misuse:** Identify common ways users might misuse the API (e.g., attempting to perform numeric operations on text columns) and implement specific `TypeError` messages for these scenarios.

3.  **Document Error Resolution:** Provide a dedicated section in the documentation that explains common type errors and how to debug and resolve them.

This roadmap will be iteratively refined as development progresses and new insights are gained.